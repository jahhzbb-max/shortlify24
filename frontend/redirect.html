<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Redirecting...</title>

<style>
body {
  margin: 0;
  font-family: "Poppins", sans-serif;
  background: linear-gradient(135deg, #0d0f1a 0%, #131727 100%);
  color: #fff;
  text-align: center;
  padding: 40px;
  overflow-x: hidden;
}
.particle {
  position: absolute;
  width: 6px; height: 6px;
  background: rgba(120,132,255,0.7);
  border-radius: 50%;
  animation: floatUp 6s linear infinite;
}
@keyframes floatUp {
  0% { transform: translateY(0); opacity: 1; }
  100% { transform: translateY(-200px); opacity: 0; }
}
.box {
  background: rgba(255,255,255,0.12);
  backdrop-filter: blur(18px);
  padding: 40px;
  border-radius: 22px;
  width: 90%; max-width: 520px;
  margin: 60px auto;
  box-shadow: 0 0 25px rgba(120,132,255,0.25);
}
#countdown { font-size: 3.8rem; margin-bottom: 10px; color: #6e82ff; }
button {
  margin-top: 20px;
  padding: 14px 24px;
  border-radius: 12px;
  border: none; cursor: pointer;
  background: #6c7bff; color: #fff; font-size: 1rem;
}
#goBtn { display: none; }
.copyBtn { background: #00c27a; }
.shareBtn { background: #ff6f3c; margin-left: 10px; }
#finalLink { margin-top: 12px; color: #d0d4ff; word-break: break-all; }
</style>
</head>

<body>

<script>
// floating particles
for (let i = 0; i < 30; i++) {
  let p = document.createElement("div");
  p.className = "particle";
  p.style.left = Math.random() * window.innerWidth + "px";
  p.style.top = Math.random() * window.innerHeight + "px";
  document.body.appendChild(p);
}
</script>

<div class="box">
  <h2>Redirecting In</h2>
  <div id="countdown">10</div>

  <b>Destination:</b>
  <div id="finalLink">Loading...</div>

  <button id="goBtn">Get Link</button>
  <button class="copyBtn" id="copyBtn">Copy URL</button>
  <button class="shareBtn" id="shareBtn">Share</button>
</div>

<script>
const BACKEND = "https://shortlify24.onrender.com";

// get all buttons
const goBtn = document.getElementById("goBtn");
const copyBtn = document.getElementById("copyBtn");
const shareBtn = document.getElementById("shareBtn");
const finalLinkDiv = document.getElementById("finalLink");
const countdownDiv = document.getElementById("countdown");

// correct parameter (c)
const id = new URLSearchParams(location.search).get("c");

let finalURL = null;

// Fetch original URL
fetch(`${BACKEND}/api/info/${id}`)
  .then(r => r.json())
  .then(data => {
    if (data.originalUrl) {
      finalURL = data.originalUrl;
      finalLinkDiv.textContent = finalURL;
    } else {
      finalLinkDiv.textContent = "Invalid or Expired Link";
    }
  })
  .catch(() => finalLinkDiv.textContent = "Error loading link!");

// Countdown
let sec = 10;
let timer = setInterval(() => {
  countdownDiv.innerText = sec;
  if (sec-- <= 0) {
    clearInterval(timer);
    goBtn.style.display = "inline-block";
  }
}, 1000);

// Go button click â†’ popup + ads
goBtn.onclick = () => {
  if (!finalURL) return;

  // Open final URL in popup tab
  window.open(finalURL, "_blank");

  // ads/video in current tab
  location.href = "ads/video.html";
};

// Copy
copyBtn.onclick = () => {
  navigator.clipboard.writeText(finalURL || "");
  copyBtn.textContent = "Copied!";
  setTimeout(() => copyBtn.textContent = "Copy URL", 1500);
};

// Share
shareBtn.onclick = () => {
  if (navigator.share) {
    navigator.share({ title: "Shortened Link", url: finalURL });
  } else {
    alert("Sharing not supported");
  }
};
</script>

</body>
</html>
